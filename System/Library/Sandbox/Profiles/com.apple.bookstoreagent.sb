(version 1)
(deny default)

(import "system.sb")
(import "com.apple.corefoundation.sb")
(corefoundation)

(allow file-read-metadata)

(allow file-read*
       (literal "/")
       (literal "/private/etc/hosts")
       (literal "/Library/Preferences/.GlobalPreferences.plist")
       (literal "/private/var/db/mds/messages/se_SecurityMessages")
       (literal "/private/var/db/.MASManifest")
       (literal "/Library/Preferences/com.apple.SoftwareUpdate.plist")
       (literal "/private/var/db/mds/system/mdsDirectory.db")
       (literal "/private/var/db/mds/system/mdsObject.db")
	   (literal "/private/var/db/mds/system/mds.lock")
       (regex #"/Library/Preferences/com\.apple\.appstore\.plist$")
	   (regex #"/Library/Preferences/com\.apple\.StreamingUnzipService\.plist$")
       (regex #"/Library/Preferences/com\.apple\.ibooks\.plist$")
       (regex #"/Library/Preferences/\.GlobalPreferences\.plist$")
       (regex #"/Library/Preferences/ByHost/\.GlobalPreferences\.")
       (regex #"/Library/Preferences/com.apple.security\.plist$")
	   (regex #"/Library/Preferences/com\.apple\.iBooksX\.secure\.plist$")
	   (regex #"/Library/Preferences/com\.apple\.iTunes\.secure\.plist$")
	   (regex #"/\.CFUserTextEncoding$")
       (regex #"/Library/Caches/com\.apple\.storeagent/updates-com\.apple\.appstore\.updateQueue\.plist$"))
	   
(allow file-read* file-write*
       (literal "/Library/Caches/com.apple.DiagnosticReporting.Networks.plist")
	   (literal "/Library/Caches/com.apple.DiagnosticReporting.HasBeenAppleInternal")
       (subpath "/private/var/root/Library/Caches/com.apple.storeagent")
       (subpath "/Users/Shared/SC Info")
       (subpath "/private/var/tmp")
       (subpath "/private/tmp")
	   (subpath "/Users/Shared/adi")
       (regex #"/Library/Caches/com\.apple\.WebKit\.WebContent$")
       (regex #"/Library/Logs/appstore\.log$")
       (regex #"/Library/Logs/bookstoreagent(/|$)")
       (regex #"/Library/Caches/storeagent")
       (regex #"/Library/Caches/bookstoreagent")
       (regex #"/Library/Caches/com\.apple\.storeagent")
       (regex #"/Library/Caches/com\.apple\.bookstoreagent")
       (regex #"/Library/Caches/com\.apple\.WebKit2\.WebProcessService$")
       (regex #"/Library/Cookies")
       (regex #"/Library/Preferences$")
       (regex #"/Library/Preferences/com\.apple\.storeagent\.plist$")
       (regex #"/Library/Preferences/com\.apple\.bookstoreagent\.plist$")
       (regex #"Library/Preferences/com\.apple\.security\.revocation\.plist")
       (regex #"^/private/var/folders/[^/]+/[^/]+/[A-Z]/TemporaryItems(/|$)")
       (regex #"^/private/var/folders/[^/]+/[^/]+/[A-Z]/mds(/|$)")
       (regex #"/\.TemporaryItems(/|$)")
       (regex #"^/etilqs_"))
	   
(allow file-read* file-write* file-issue-extension
       (regex #"^/private/var/folders/[^/]+/[^/]+/[A-Z]/com\.apple\.appstore")
       (regex #"^/private/var/folders/[^/]+/[^/]+/[A-Z]/com\.apple\.iBooksX"))

(allow ipc-posix-shm-read-data
       (ipc-posix-name "FNetwork.defaultStorageSession")
       (ipc-posix-name-regex #"ls\.[a-f0-9\.]+")
       (ipc-posix-name "apple.shm.notification_center")
       (ipc-posix-name-regex #"^/tmp/com.apple.csseed.[0-9]+$"))

(allow ipc-posix-shm-read* ipc-posix-shm-write-data
       (ipc-posix-name "com.apple.AppleDatabaseChanged"))
	   
(allow mach-register
       (global-name "com.apple.bookstoreagent-xpc"))

(allow mach-lookup
       (global-name "com.apple.UNCUserNotification")
       (global-name "com.apple.coreservices.launcherror-handler")
       (global-name "com.apple.softwareupdated")
       (global-name "com.apple.SystemConfiguration.configd")
       (global-name "com.apple.bookstoreagent-xpc")
	   (global-name "com.apple.DiskArbitration.diskarbitrationd")
       (global-name "com.apple.SystemConfiguration.SCNetworkReachability")
       (global-name "com.apple.networkd")
       (global-name "com.apple.ibooks.CKSignInPrompt.hostclient")
       (global-name "com.apple.storehelper")
       (global-name "com.apple.SecurityServer")
       (global-name "com.apple.PowerManagement.control")
       (global-name "com.apple.distributed_notifications@Uv3")
       (global-name "com.apple.usernoted.daemon_client")
       (global-name "com.apple.metadata.mds")
       (global-name "com.apple.CoreServices.coreservicesd")
       (global-name "com.apple.ls.boxd")
       (global-name "com.apple.FileCoordination")
       (global-name "com.apple.ocspd")
       (global-name "com.apple.dock.appstore")
       (global-name "com.apple.installd")
       (global-name "com.apple.ProgressReporting")
       (global-name "com.apple.storereceiptinstaller")
       (global-name "com.apple.windowserver.active")
       (global-name "com.apple.dock.launchpad")
	   (global-name "com.apple.coreservices.launchservicesd")
       (global-name "com.apple.coreservices.appleevents")
	   (global-name "com.apple.cookied")
       (global-name "com.apple.FontServer")
	   (global-name "com.apple.DiskArbitration.diskarbitrationd")
       (global-name "com.apple.cvmsServ"))

(allow file-read* file-write* (extension "com.apple.app-sandbox.read-write"))

(allow authorization-right-obtain
       (right-name "system.install.app-store-software")
       (right-name "system.install.apple-software")
       (right-name "system.install.apple-config-data")
       (right-name "system.install.software")
       (right-name "system.install.software.iap")
       (right-name "com.apple.SoftwareUpdate.modify-settings"))

(allow iokit-open
       (iokit-user-client-class "IOFramebufferSharedUserClient")
       (iokit-user-client-class "RootDomainUserClient")
       (iokit-user-client-class "AMDAccelDevice")
       (iokit-user-client-class "AMDAccelSharedUserClient")
       (iokit-user-client-class "AMDR8xxGLContext"))

(allow signal)
(allow network-outbound)
(allow system-socket)
(allow distributed-notification-post)
